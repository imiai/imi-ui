{"version":3,"file":"index.js","sources":["../../../src/components/bottom-sheet/index.tsx"],"sourcesContent":["import { CloseIcon } from \"../../icons\";\nimport React, { useState, useEffect, useCallback, useLayoutEffect, createRef } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport './styles.scss';\nimport { useResizeObserver } from \"../../hooks\";\n\ninterface IBottomSheetProps {\n    title?: string;\n    headrLeftIcon?: React.ReactNode;\n    onIconClick?: Function;\n    onClose?: Function;\n    open: Boolean;\n    clickOutsideToClose?: Boolean;\n    children?: React.ReactNode;\n    className?: string;\n}\n\nconst BottomSheetJsx = (props: IBottomSheetProps) => {\n    const { title, open = false, headrLeftIcon, clickOutsideToClose = false, onClose = () => { }, onIconClick = () => { }, children, className } = props;\n    const [isStartDragging, setIsStartDragging] = useState(false);\n    const [positionTop, setPositionTop] = useState(`${window.innerHeight + 12}px`);\n    const [initTop, setInitTop] = useState(`${window.innerHeight + 12}px`);\n    const [opacity, setOpacity] = useState(0);\n    const [openSheet, setOpenSheet] = useState(open);\n\n    const { ref, width = 1, height = 1 } = useResizeObserver<HTMLDivElement>();\n\n    useEffect(() => {\n        let id = setTimeout(() => {\n            setOpenSheet(open)\n        }, 50)\n        return () => clearTimeout(id)\n    }, [open])\n\n    useEffect(() => {\n        document.body.style.overflow = 'hidden';\n        return () => { document.body.style.overflow = 'unset'; }\n    }, [])\n\n    useEffect(() => {\n        let el = document.getElementById('imiui-bottomsheet-container')\n        let headerHeight = title ? 48 : 40;\n        let contentHeight = height;\n        let bottomSheetHeight = headerHeight + contentHeight;\n        let maxTop = window.innerHeight * 0.1 - headerHeight;\n        if (el && openSheet) {\n            if (window.innerHeight - bottomSheetHeight > maxTop) {\n                setPositionTop(`${window.innerHeight - bottomSheetHeight}px`)\n                setInitTop(`${window.innerHeight - bottomSheetHeight}px`)\n            } else {\n                setPositionTop(`${maxTop}px`);\n                setInitTop(`${maxTop}px`);\n            }\n        }\n        setOpacity(0.7)\n    }, [openSheet, height])\n\n    const onCloseSheet = useCallback(() => {\n        setPositionTop(`${window.innerHeight + 12}px`);\n        setOpacity(0);\n        let timer = setTimeout(() => {\n            setOpenSheet(false);\n            clearTimeout(timer);\n            onClose();\n        }, 100)\n    }, [onClose]);\n\n    const startDrag = () => {\n        setIsStartDragging(true);\n    }\n\n    const stopStartDrag = useCallback((event: any) => {\n        let yPos = event.clientY;\n        if (event.type === 'touchstart' || event.type === 'touchmove' || event.type === 'touchend' || event.type === 'touchcancel') {\n            let touch = event.touches[0] || event.changedTouches[0];\n            yPos = touch.pageY;\n        }\n        if ((window.innerHeight - yPos) < 100) {\n            setPositionTop(`${window.innerHeight + 12}px`)\n            onCloseSheet();\n        } else {\n            setPositionTop(initTop)\n        }\n        setIsStartDragging(false);\n    }, [initTop, onCloseSheet])\n\n    const doStartDrag = useCallback((event: any) => {\n        if (!isStartDragging) {\n            return;\n        }\n        let yPos = event.clientY;\n        if (event.type === 'touchstart' || event.type === 'touchmove' || event.type === 'touchend' || event.type === 'touchcancel') {\n            let touch = event.touches[0] || event.changedTouches[0];\n            yPos = touch.pageY;\n        }\n        if (yPos < parseInt(initTop.slice(0, -2))) {\n            return;\n        }\n        setPositionTop(`${yPos}px`)\n    }, [initTop, isStartDragging]);\n\n\n    useEffect(() => {\n        if (isStartDragging) {\n            document.documentElement.addEventListener('mousemove', doStartDrag);\n            document.documentElement.addEventListener('mouseup', stopStartDrag);\n            document.documentElement.addEventListener('touchmove', doStartDrag);\n            document.documentElement.addEventListener('touchend', stopStartDrag);\n        }\n        return () => {\n            if (isStartDragging) {\n                document.documentElement.removeEventListener('mousemove', doStartDrag);\n                document.documentElement.removeEventListener('mouseup', stopStartDrag);\n                document.documentElement.removeEventListener('touchmove', doStartDrag);\n                document.documentElement.removeEventListener('touchend', stopStartDrag);\n            }\n        }\n    }, [isStartDragging, doStartDrag, stopStartDrag]);\n\n    if (!openSheet) {\n        return <></>\n    }\n\n    return (\n        <div id='imiui-bottom-sheet-wrapper' className={`imiui-bottomsheet${className ? ` ${className}` : ''}`}>\n            <div className={`overlay`} style={{ opacity: opacity }} onClick={clickOutsideToClose ? onCloseSheet : () => { }}></div>\n            <div id='imiui-bottomsheet-container' className=\"container\" style={{ top: positionTop }}>\n                <div className=\"header\" style={title ? { height: 48 } : {}} onTouchStart={startDrag} onMouseDown={startDrag}>\n                    <div className=\"indicator\" />\n                    <button className=\"icon\" onClick={() => onIconClick()}>\n                        {headrLeftIcon}\n                    </button>\n                    <span className=\"title t-label-bold-small\">{title}</span>\n                    <button className=\"close\" onClick={onCloseSheet}>\n                        <CloseIcon />\n                    </button>\n                </div>\n                <div ref={ref} className=\"content\">\n                    {children}\n                </div>\n            </div>\n        </div>\n    )\n}\n\nconst BottomSheet = (props: IBottomSheetProps) => {\n    return ReactDOM.createPortal(<BottomSheetJsx {...props} />, document.querySelector('body'))\n}\n\nexport default BottomSheet;"],"names":[],"mappings":"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"}